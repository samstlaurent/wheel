<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>Sporcle of the Day Selector</title>
	<link rel="icon" href="images/wheel.ico" type="image/ico">
	<link rel="stylesheet" href="style.css">
</head>
<body>

	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
		import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
		import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
		import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

		const firebaseConfig = {
			apiKey: "AIzaSyATilkEHEFHVUzED0ErnUcM4DoqFMxlWnQ",
			authDomain: "wheel-d9e0e.firebaseapp.com",
			projectId: "wheel-d9e0e",
			storageBucket: "wheel-d9e0e.firebasestorage.app",
			messagingSenderId: "66259585614",
			appId: "1:66259585614:web:5f86cb61233129f3a0511f",
			measurementId: "G-N7348SL49Z"
		};

		const app = initializeApp(firebaseConfig);
		const db = getFirestore(app);
		const auth = getAuth(app);
		const analytics = getAnalytics(app);
		
		signInAnonymously(auth).catch(err => console.error("Auth error:", err));
		
		let currentUserId = null;
		onAuthStateChanged(auth, (user) => {
			if (user) currentUserId = user.uid;
		});
		
		window.firebaseAddSpin = async function (spinResult) {
			try {
				await addDoc(collection(db, "wheelSpins"), {
					winner: spinResult,
					userId: currentUserId || "unknown",
					userName: window.userName || "unknown",
					timestamp: serverTimestamp()
				});
			} catch (err) {
				console.error("Firebase log error:", err);
			}
		  };
	</script>

	<canvas id="mainCanvas" width="800" height="600"></canvas>
	<div id="nameList"></div>
	<button id="instructionsButton">Instructions</button>
	<button id="simulateButton">Simulate</button>
	<button id="downloadButton" disabled>Download Video</button>
	<button id="screenshotButton" disabled>Download Screenshot</button>

	<div id="instructionsModal">
		<div id="instructionsContent">
			<h2>Instructions</h2>
			<p>
				<span class="instructionLine">
					Click the <img src="images/selectorIconDisabled.png" class="instructionsInlineIcon"> icon above your <span class="instructionsInlineNameButton">Name</span> to mark yourself as the current selector.
				</span>
				<span class="instructionLine">
					Click on the <span class="instructionsInlineNameButton">Name</span> buttons to temporarily remove those who are unavailable.
				</span>
				<span class="instructionLine">
					Spin the wheel then use <span class="instructionsInlineDownloadButton">Download Video</span> to post in the Teams chat.
				</span>
			</p>
		</div>
	</div>
	
	<div id="simulationModal">
		<div id="simulationContent">
			<h2>Simulation Results</h2>
			<div id="simulationResultsBody" style="margin-top: 10px;"></div>
			<canvas id="simulationChart" width="600" height="300"></canvas>
		</div>
	</div>

	<audio id="wheelTick" src="https://raw.githubusercontent.com/samstlaurent/wheel/main/audio/wheelTick.mp3" crossorigin=""></audio>
	<audio id="wheelStopNeutral" src="https://raw.githubusercontent.com/samstlaurent/wheel/main/audio/wheelStopNeutral.mp3" crossorigin=""></audio>
	<audio id="wheelStopParty" src="https://raw.githubusercontent.com/samstlaurent/wheel/main/audio/wheelStopParty.mp3" crossorigin=""></audio>
	<audio id="wheelStopSpectacle" src="https://raw.githubusercontent.com/samstlaurent/wheel/main/audio/wheelStopSpectacle.mp3" crossorigin=""></audio>
	<audio id="buttonPress" src="https://raw.githubusercontent.com/samstlaurent/wheel/main/audio/buttonPress.mp3" crossorigin=""></audio>

	<script src="script.js"></script>
</body>
</html>


